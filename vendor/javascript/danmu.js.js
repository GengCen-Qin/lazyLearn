// danmu.js@1.1.13 downloaded from https://ga.jspm.io/npm:danmu.js@1.1.13-douyin-2.4/dist/index.js

var t=typeof globalThis!=="undefined"?globalThis:typeof self!=="undefined"?self:global;var e={};!function(t,n){e=n()}(window,(function(){return function(t){var e={};function n(i){if(e[i])return e[i].exports;var o=e[i]={i:i,l:!1,exports:{}};return t[i].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)n.d(i,o,function(e){return t[e]}.bind(null,o));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=5)}([function(e,n,i){Object.defineProperty(n,"__esModule",{value:!0}),n.createDom=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"div",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",o=document.createElement(t);return o.className=i,o.innerHTML=e,Object.keys(n).forEach((function(e){var i=e,r=n[e];"video"===t||"audio"===t?r&&o.setAttribute(i,r):o.setAttribute(i,r)})),o},n.hasClass=o,n.addClass=r,n.removeClass=a,n.toggleClass=function(t,e){e.split(/\s+/g).forEach((function(e){o(t,e)?a(t,e):r(t,e)}))},n.findDom=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document,e=arguments[1],n=void 0;try{n=t.querySelector(e)}catch(i){e.startsWith("#")&&(n=t.getElementById(e.slice(1)))}return n},n.deepCopy=function t(e,n){if("Object"===s(n)&&"Object"===s(e))return Object.keys(n).forEach((function(i){"Object"!==s(n[i])||n[i]instanceof Node?"Array"===s(n[i])?e[i]="Array"===s(e[i])?e[i].concat(n[i]):n[i]:e[i]=n[i]:e[i]?t(e[i],n[i]):e[i]=n[i]})),e},n.typeOf=s,n.copyDom=function(t){if(t&&1===t.nodeType){var e=document.createElement(t.tagName);return Array.prototype.forEach.call(t.attributes,(function(t){e.setAttribute(t.name,t.value)})),t.innerHTML&&(e.innerHTML=t.innerHTML),e}return""},n.attachEventListener=function(t,e,n,i){i?(t.on(e,n),function(t,e,n,i){t.once(i,(function o(){t.off(e,n),t.off(i,o)}))}(t,e,n,i)):t.on(e,(function i(o){n(o),t.off(e,i)}))},n.styleUtil=function(t,e,n){if(t){var i=t.style;try{i[e]=n}catch(t){i.setProperty(e,n)}}},n.styleCSSText=function(t,e){var n=t.style;try{n.cssText=e}catch(t){}},n.isNumber=function(t){return"number"==typeof t&&!Number.isNaN(t)},n.isFunction=function(t){return"function"==typeof t},n.throttle=function(e,n){var i=this||t,o=0;return function(){for(var t=arguments.length,r=Array(t),a=0;a<t;a++)r[a]=arguments[a];clearTimeout(o),o=setTimeout((function(){return e.apply(i,r)}),n)}};n.hasOwnProperty=Object.prototype.hasOwnProperty;function o(t,e){return t.classList?Array.prototype.some.call(t.classList,(function(t){return t===e})):!!t.className.match(new RegExp("(\\s|^)"+e+"(\\s|$)"))}function r(t,e){t.classList?e.replace(/(^\s+|\s+$)/g,"").split(/\s+/g).forEach((function(e){e&&t.classList.add(e)})):o(t,e)||(t.className+=" "+e)}function a(t,e){t.classList?e.split(/\s+/g).forEach((function(e){t.classList.remove(e)})):o(t,e)&&e.split(/\s+/g).forEach((function(e){var n=new RegExp("(\\s|^)"+e+"(\\s|$)");t.className=t.className.replace(n," ")}))}function s(t){return Object.prototype.toString.call(t).match(/([^\s.*]+)(?=]$)/g)[0]}n.getTimeStamp=function(){return"undefined"!=typeof window&&window.performance&&"function"==typeof window.performance.now?performance.now():Date.now()}},function(e,n,i){Object.defineProperty(n,"__esModule",{value:!0});var o,r=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),a=i(4),s=(o=a)&&o.__esModule?o:{default:o};var l=function(){function e(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this||t,e)}return r(e,[{key:"setLogger",value:function(e){(this||t).logger=e instanceof s.default?e:new s.default((e||"")+".js")}}]),e}();n.default=l,e.exports=n.default},function(t,e,n){var i=n(19)();t.exports=function(t){return t!==i&&null!==t}},function(t,e,n){t.exports=function(t){return null!=t}},function(e,n,i){Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}();var r="undefined"!=typeof window&&window.location.href.indexOf("danmu-debug")>-1,a=function(){function e(n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this||t,e),(this||t).constructorName=n||""}return o(e,[{key:"info",value:function(e){for(var n,i=arguments.length,o=Array(i>1?i-1:0),a=1;a<i;a++)o[a-1]=arguments[a];r&&(n=console).log.apply(n,["[Danmu Log]["+(this||t).constructorName+"]",e].concat(o))}}]),e}();n.default=a,e.exports=n.default},function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0});var i,o=n(6),r=(i=o)&&i.__esModule?i:{default:i};n(34),e.default=r.default,t.exports=e.default},function(e,n,i){Object.defineProperty(n,"__esModule",{value:!0}),n.DanmuJs=void 0;var o=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),r=f(i(7)),a=i(26),s=f(i(1)),l=f(i(27)),u=f(i(32)),c=i(33),h=i(0);function f(t){return t&&t.__esModule?t:{default:t}}function d(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}var p=n.DanmuJs=function(e){function n(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this||t,n);var i=d(this||t,(n.__proto__||Object.getPrototypeOf(n)).call(this||t));i.setLogger("danmu"),i.logger&&i.logger.info("danmu.js version: "+a.version);var o=i.config={overlap:!1,area:{start:0,end:1,lines:void 0},hooks:void 0,live:!1,comments:[],direction:"r2l",needResizeObserver:!1,dropStaleComments:!1,channelSize:void 0,maxCommentsLength:void 0,bulletOffset:void 0,interval:2e3,highScorePriority:!0,chaseEffect:!0};if((0,h.deepCopy)(o,e),(0,r.default)(i),i.globalHooks={},o.hooks&&i.hooks(o.hooks),i.hideArr=[],i.recycler=new u.default,i.getBoundingCounts=0,i.danmuElCreateCounts=0,i.readDataTimes=-1,i.attachTimes=-1,i.startMoveTimes=-1,i.freezeId=null,o.comments.forEach((function(t){t.duration=t.duration?t.duration:5e3,t.mode||(t.mode="scroll")})),i.container=o.container&&1===o.container.nodeType?o.container:null,!i.container)return i.emit("error","container id can't be empty"),!1,d(i,!1);if(o.containerStyle){var s=o.containerStyle;Object.keys(s).forEach((function(t){i.container.style[t]=s[t]}))}return(0,h.addClass)(i.container,"danmu"),i.live=o.live,i.player=o.player,i.direction=o.direction,i.bulletBtn=new l.default(i),i.main=i.bulletBtn.main,i.isReady=!0,i.emit("ready"),i.logger&&i.logger.info("ready"),i.addResizeObserver(),i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(n,e),o(n,[{key:"updateGetBoundingCounts",value:function(e){void 0!==(this||t).getBoundingCounts&&("number"==typeof e?(this||t).getBoundingCounts=e:(this||t).getBoundingCounts++)}},{key:"updateDanmuElCreateCounts",value:function(e){void 0!==(this||t).danmuElCreateCounts&&("number"==typeof e?(this||t).danmuElCreateCounts=e:(this||t).danmuElCreateCounts++)}},{key:"updateReadDataTimes",value:function(){(this||t).readDataTimes<0&&((this||t).readDataTimes=(0,h.getTimeStamp)())}},{key:"updateAttachTimes",value:function(){(this||t).attachTimes<0&&((this||t).attachTimes=(0,h.getTimeStamp)())}},{key:"updateStartMoveTimes",value:function(){(this||t).startMoveTimes<0&&((this||t).startMoveTimes=(0,h.getTimeStamp)())}},{key:"hooks",value:function(e){(0,h.deepCopy)((this||t).globalHooks,e)}},{key:"addResizeObserver",value:function(){var e=this||t;(this||t).config.needResizeObserver&&(this||t).container&&(0,c.addObserver)((this||t).container,(function(){e.logger&&e.logger.info("needResizeObserver"),e.resize()}))}},{key:"start",value:function(){(this||t).logger&&(this||t).logger.info("start"),(this||t).main&&(this||t).main.start()}},{key:"pause",value:function(){(this||t).logger&&(this||t).logger.info("pause"),(this||t).main&&(this||t).main.pause()}},{key:"play",value:function(){(this||t).logger&&(this||t).logger.info("play"),(this||t).main&&(this||t).main.play()}},{key:"stop",value:function(){(this||t).logger&&(this||t).logger.info("stop"),(this||t).main&&(this||t).main.stop()}},{key:"clear",value:function(){(this||t).logger&&(this||t).logger.info("clear"),(this||t).main&&(this||t).main.clear()}},{key:"destroy",value:function(){for(var e in(0,c.unObserver)((this||t).container),(this||t).logger&&(this||t).logger.info("destroy"),this.stop(),(this||t).bulletBtn&&(this||t).bulletBtn.destroy(),(this||t).recycler&&(this||t).recycler.destroy(),this||t)delete(this||t)[e];this.emit("destroy")}},{key:"sendComment",value:function(e){var n=(this||t).main,i=(this||t).logger;i&&i.info("sendComment: "+(e.txt||"[DOM Element]")),n&&(e.duration||(e.duration=15e3),e&&e.id&&e.duration&&(e.el||e.elLazyInit||e.txt)&&(e.duration=e.duration?e.duration:5e3,e.style||(e.style={opacity:void 0,fontSize:void 0}),e.style&&((this||t).opacity&&(this||t).opacity!==e.style.opacity&&(e.style.opacity=(this||t).opacity),(this||t).fontSize&&(this||t).fontSize!==e.style.fontSize&&(e.style.fontSize=(this||t).fontSize)),e.prior||e.realTime?(n.data.unshift(e),e.realTime&&((this||t).config&&(this||t).config.trackAllocationOptimization?n.readDataV1():(n.readData(),n.dataHandle()))):n.data.push(e),n.sortData(),n.keepPoolWatermark()))}},{key:"setCommentID",value:function(e,n){var i=this||t;(this||t).logger&&(this||t).logger.info("setCommentID: oldID "+e+" newID "+n),e&&n&&((this||t).main.data.some((function(t){return t.id===e&&(t.id=n,!0)})),(this||t).main.queue.some((function(t){return t.id===e&&(t.id=n,t.pauseMove(),"paused"!==i.main.status&&t.startMove(),!0)})))}},{key:"setCommentDuration",value:function(e,n){var i=this||t;(this||t).logger&&(this||t).logger.info("setCommentDuration: id "+e+" duration "+n),e&&n&&(n=n||5e3,(this||t).main.data.some((function(t){return t.id===e&&(t.duration=n,!0)})),(this||t).main.queue.some((function(t){return t.id===e&&(t.duration=n,t.pauseMove(),"paused"!==i.main.status&&t.startMove(),!0)})))}},{key:"setCommentLike",value:function(e,n){(this||t).logger&&(this||t).logger.info("setCommentLike: id "+e+" like "+n),e&&n&&((this||t).main.data.some((function(t){return t.id===e&&(t.like=n,!0)})),(this||t).main.queue.some((function(t){return t.id===e&&(t.pauseMove(),t.setLikeDom(n.el,n.style),"paused"!==t.danmu.main.status&&t.startMove(),!0)})))}},{key:"restartComment",value:function(e){if((this||t).logger&&(this||t).logger.info("restartComment: id "+e),e){var n=(this||t).main;if(this._releaseCtrl(e),"closed"===n.status)return;n.queue.some((function(t){return t.id===e&&("paused"!==n.status?t.startMove(!0):t.status="paused",!0)}))}}},{key:"_releaseCtrl",value:function(e){(this||t).freezeId&&e===(this||t).freezeId&&((this||t).mouseControl=!1,(this||t).freezeId=null)}},{key:"_freezeCtrl",value:function(e){(this||t).mouseControl=!0,(this||t).freezeId=e}},{key:"freezeComment",value:function(e){((this||t).logger&&(this||t).logger.info("freezeComment: id "+e),e)&&(this._freezeCtrl(e),(this||t).main.queue.some((function(t){return t.id===e&&(t.status="forcedPause",t.pauseMove(),t.el&&t.el.style&&(0,h.styleUtil)(t.el,"zIndex",10),!0)})))}},{key:"removeComment",value:function(e){if((this||t).logger&&(this||t).logger.info("removeComment: id "+e),e){var n=(this||t).main;this._releaseCtrl(e),n.queue=n.queue.filter((function(t){return t.id!==e||(t.remove(),!1)})),n.data=n.data.filter((function(t){return t.id!==e}))}}},{key:"updateComments",value:function(e){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];(this||t).logger&&(this||t).logger.info("updateComments: "+e.length+", isClear "+n);var i=(this||t).main;"boolean"==typeof n&&n&&(i.data=[]),i.data||(i.data=[]),i.data=i.data.concat(e),i.sortData(),i.keepPoolWatermark()}},{key:"setAllDuration",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"scroll",n=this||t,i=arguments[1],o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];(this||t).logger&&(this||t).logger.info("setAllDuration: mode "+e+" duration "+i+" force "+o),i&&(i=i||5e3,o&&((this||t).main.forceDuration=i),(this||t).main.data.forEach((function(t){e===t.mode&&(t.duration=i)})),(this||t).main.queue.forEach((function(t){e===t.mode&&(t.duration=i,t.pauseMove(),"paused"!==n.main.status&&t.startMove())})))}},{key:"setPlayRate",value:function(){var e=this||t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"scroll",i=arguments[1];(this||t).logger&&(this||t).logger.info("setPlayRate: "+i),(0,h.isNumber)(i)&&i>0&&((this||t).main.playRate=i,(this||t).main.queue.forEach((function(t){n===t.mode&&(t.pauseMove(),"paused"!==e.main.status&&t.startMove())})))}},{key:"setOpacity",value:function(e){(this||t).logger&&(this||t).logger.info("setOpacity: opacity "+e),(this||t).container&&((this||t).container.style.opacity=e)}},{key:"setFontSize",value:function(e,n,i){(this||t).config&&(this||t).config.trackAllocationOptimization?this.setFontSizeV1(e,n,i):this.setFontSizeV0(e,n,i)}},{key:"setFontSizeV0",value:function(e,n){var i=this||t,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{reflow:!0};(this||t).logger&&(this||t).logger.info("setFontSize: size "+e+" channelSize "+n),(this||t).fontSize=e+"px",e&&((this||t).main.data.forEach((function(t){t.style&&(t.style.fontSize=i.fontSize)})),(this||t).main.queue.forEach((function(t){t.options.style||(t.options.style={}),t.options.style.fontSize=i.fontSize,t.setFontSize(i.fontSize),n&&(t.top=t.channel_id[0]*n,t.topInit())}))),n&&((this||t).config.channelSize=n,o.reflow&&(this||t).main.channel.resizeSync())}},{key:"setFontSizeV1",value:function(e,n){var i=this||t;if(e&&(this||t).fontSize!==e+"px")if((this||t).fontSize||(this||t).fontSizeItem!==e+"px"){(this||t).fontSize=e+"px",(this||t).main.data.forEach((function(t){t.style&&(t.style.fontSize=i.fontSize)}));for(var o=(this||t).main.queue,r=0,a=0;a<o.length&&r<1e3;r++){var s=o.findIndex((function(t){return t.el&&t.el.style&&t.el.style.fontSize!==i.fontSize})),l=o[a=s>=0?s:0];if(a>=o.length||s<0)break;l.options.style||(l.options.style={}),l.options.style.fontSize=(this||t).fontSize,l.setFontSize((this||t).fontSize),l.top=l.channelId*n,l.topInit(),l.pauseMove()}(this||t).config.channelSize=n,this.updateQueueTimestamp(),(this||t).main&&(this||t).main.channel&&(this||t).main.channel.updateChannlState&&(this||t).main.channel.updateChannlState(n)}else(this||t).fontSize=(this||t).fontSizeItem}},{key:"updateQueueTimestamp",value:function(){if((this||t).main.channel&&(this||t).main.channel.channels&&(this||t).main.channel.channels){var e="paused"!==(this||t).main.status,n=(this||t).main.channel||{},i=n.containerLeft,o=n.containerRight;(this||t).main.channel.channels.forEach((function(t){if(t&&t.queue&&t.queue.scroll&&0!==t.queue.scroll.length)for(var n=t.queue.scroll,r=n.length,a=(0,h.getTimeStamp)(),s=r-1;s>=0;s--){var l=n[s];if(l&&l.el){l.recalculate=!0,l.waitTimeStamp=0;var u=n[s+1],c=l.updatePosition();if(c.right<i)l.remove(!1);else if(u){var f=u.fullLeaveTime-a,d=i+(u.fullLeaveTime-a)*u.moveVV1,p=Math.max(d,c.left),m=(p-i)/l.moveVV1,v=p+Math.max(f-m,0)*l.moveVV1;v!==c.left&&(0,h.styleUtil)(l.el,"left",v+"px");var g=v+c.width,y=g/l.moveVV1;l.fullLeaveTime=a+y,e&&(l.fullEnterTime=g>o?a+(g-o)/l.moveVV1:-1,(0,h.styleUtil)(l.el,"transition","transform "+y/1e3+"s linear 0s"),(0,h.styleUtil)(l.el,"transform","translateX(-"+g+"px) translateZ(0px)"),l.status="start")}else{var b=c.right-i,_=b/l.moveVV1;l.fullLeaveTime=a+_,e&&(l.fullEnterTime=c.right>o?a+(c.right-o)/l.moveVV1:-1,(0,h.styleUtil)(l.el,"transition","transform "+_/1e3+"s linear 0s"),(0,h.styleUtil)(l.el,"transform","translateX(-"+b+"px)"),l.status="start")}}}}))}}},{key:"setArea",value:function(e,n,i){(this||t).config&&(this||t).config.trackAllocationOptimization?this.setAreaV1(e,n,i):this.setAreaV0(e,n,i)}},{key:"setAreaV0",value:function(e){(this||t).logger&&(this||t).logger.info("setArea: area "+e),(this||t).config.area=e,!1!==e.reflow&&(this||t).main.channel.resizeSync()}},{key:"setAreaV1",value:function(e){(this||t).config.area=e,(this||t).main&&(this||t).main.channel&&(this||t).main.channel.updateChannlState&&(this||t).main.channel.updateChannlState()}},{key:"hide",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"scroll";(this||t).logger&&(this||t).logger.info("hide: mode "+e),(this||t).hideArr.indexOf(e)<0&&(this||t).hideArr.push(e);var n=(this||t).main.queue.filter((function(t){return e===t.mode||"color"===e&&t.color}));n.forEach((function(t){return t.remove()}))}},{key:"show",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"scroll";(this||t).logger&&(this||t).logger.info("show: mode "+e);var n=(this||t).hideArr.indexOf(e);n>-1&&(this||t).hideArr.splice(n,1)}},{key:"setDirection",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"r2l";(this||t).logger&&(this||t).logger.info("setDirection: direction "+e),(this||t).direction=e,this.emit("changeDirection",e)}},{key:"resize",value:function(){(this||t).logger&&(this||t).logger.info("resize"),this.emit("channel_resize")}},{key:"status",get:function(){return(this||t).main?(this||t).main.status:"destroy"}},{key:"state",get:function(){var e=(this||t).main;return{status:e.status,comments:e.data,bullets:e.queue,displayArea:e.channel.getRealOccupyArea()}}},{key:"containerPos",get:function(){return(this||t).main.channel.containerPos}}]),n}(s.default);n.default=p},function(e,n,i){var o,r,a,s,l,u,c,h=i(8),f=i(25),d=Function.prototype.apply,p=Function.prototype.call,m=Object.create,v=Object.defineProperty,g=Object.defineProperties,y=Object.prototype.hasOwnProperty,b={configurable:!0,enumerable:!1,writable:!0};r=function(e,n){var i,r;return f(n),r=this||t,o.call(this||t,e,i=function(){a.call(r,e,i),d.call(n,this||t,arguments)}),i.__eeOnceListener__=n,this||t},l={on:o=function(e,n){var i;return f(n),y.call(this||t,"__ee__")?i=(this||t).__ee__:(i=b.value=m(null),v(this||t,"__ee__",b),b.value=null),i[e]?"object"==typeof i[e]?i[e].push(n):i[e]=[i[e],n]:i[e]=n,this||t},once:r,off:a=function(e,n){var i,o,r,a;if(f(n),!y.call(this||t,"__ee__"))return this||t;if(!(i=(this||t).__ee__)[e])return this||t;if("object"==typeof(o=i[e]))for(a=0;r=o[a];++a)r!==n&&r.__eeOnceListener__!==n||(2===o.length?i[e]=o[a?0:1]:o.splice(a,1));else o!==n&&o.__eeOnceListener__!==n||delete i[e];return this||t},emit:s=function(e){var n,i,o,r,a;if(y.call(this||t,"__ee__")&&(r=(this||t).__ee__[e]))if("object"==typeof r){for(i=arguments.length,a=new Array(i-1),n=1;n<i;++n)a[n-1]=arguments[n];for(r=r.slice(),n=0;o=r[n];++n)d.call(o,this||t,a)}else switch(arguments.length){case 1:p.call(r,this||t);break;case 2:p.call(r,this||t,arguments[1]);break;case 3:p.call(r,this||t,arguments[1],arguments[2]);break;default:for(i=arguments.length,a=new Array(i-1),n=1;n<i;++n)a[n-1]=arguments[n];d.call(r,this||t,a)}}},u={on:h(o),once:h(r),off:h(a),emit:h(s)},c=g({},u),e.exports=n=function(t){return null==t?m(c):g(Object(t),u)},n.methods=l},function(t,e,n){var i=n(3),o=n(9),r=n(13),a=n(21),s=n(22);(t.exports=function(t,e){var n,o,l,u,c;return arguments.length<2||"string"!=typeof t?(u=e,e=t,t=null):u=arguments[2],i(t)?(n=s.call(t,"c"),o=s.call(t,"e"),l=s.call(t,"w")):(n=l=!0,o=!1),c={value:e,configurable:n,enumerable:o,writable:l},u?r(a(u),c):c}).gs=function(t,e,n){var l,u,c,h;return"string"!=typeof t?(c=n,n=e,e=t,t=null):c=arguments[3],i(e)?o(e)?i(n)?o(n)||(c=n,n=void 0):n=void 0:(c=e,e=n=void 0):e=void 0,i(t)?(l=s.call(t,"c"),u=s.call(t,"e")):(l=!0,u=!1),h={get:e,set:n,configurable:l,enumerable:u},c?r(a(c),h):h}},function(t,e,n){var i=n(10),o=/^\s*class[\s{/}]/,r=Function.prototype.toString;t.exports=function(t){return!!i(t)&&!o.test(r.call(t))}},function(t,e,n){var i=n(11);t.exports=function(t){if("function"!=typeof t)return!1;if(!hasOwnProperty.call(t,"length"))return!1;try{if("number"!=typeof t.length)return!1;if("function"!=typeof t.call)return!1;if("function"!=typeof t.apply)return!1}catch(t){return!1}return!i(t)}},function(t,e,n){var i=n(12);t.exports=function(t){if(!i(t))return!1;try{return!!t.constructor&&t.constructor.prototype===t}catch(t){return!1}}},function(t,e,n){var i=n(3),o={object:!0,function:!0,undefined:!0};t.exports=function(t){return!!i(t)&&hasOwnProperty.call(o,typeof t)}},function(t,e,n){t.exports=n(14)()?Object.assign:n(15)},function(t,e,n){t.exports=function(){var t,e=Object.assign;return"function"==typeof e&&(e(t={foo:"raz"},{bar:"dwa"},{trzy:"trzy"}),t.foo+t.bar+t.trzy==="razdwatrzy")}},function(t,e,n){var i=n(16),o=n(20),r=Math.max;t.exports=function(t,e){var n,a,s,l=r(arguments.length,2);for(t=Object(o(t)),s=function(i){try{t[i]=e[i]}catch(t){n||(n=t)}},a=1;a<l;++a)i(e=arguments[a]).forEach(s);if(void 0!==n)throw n;return t}},function(t,e,n){t.exports=n(17)()?Object.keys:n(18)},function(t,e,n){t.exports=function(){try{return Object.keys("primitive"),!0}catch(t){return!1}}},function(t,e,n){var i=n(2),o=Object.keys;t.exports=function(t){return o(i(t)?Object(t):t)}},function(t,e,n){t.exports=function(){}},function(t,e,n){var i=n(2);t.exports=function(t){if(!i(t))throw new TypeError("Cannot use null or undefined");return t}},function(t,e,n){var i=n(2),o=Array.prototype.forEach,r=Object.create,a=function(t,e){var n;for(n in t)e[n]=t[n]};t.exports=function(t){var e=r(null);return o.call(arguments,(function(t){i(t)&&a(Object(t),e)})),e}},function(t,e,n){t.exports=n(23)()?String.prototype.contains:n(24)},function(t,e,n){var i="razdwatrzy";t.exports=function(){return"function"==typeof i.contains&&!0===i.contains("dwa")&&!1===i.contains("foo")}},function(e,n,i){var o=String.prototype.indexOf;e.exports=function(e){return o.call(this||t,e,arguments[1])>-1}},function(t,e,n){t.exports=function(t){if("function"!=typeof t)throw new TypeError(t+" is not a function");return t}},function(t){t.exports=JSON.parse('{"version":"1.1.13-douyin-2.4"}')},function(e,n,i){Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),r=l(i(1)),a=l(i(28)),s=i(0);function l(t){return t&&t.__esModule?t:{default:t}}var u=function(e){function n(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this||t,n);var i=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this||t,(n.__proto__||Object.getPrototypeOf(n)).call(this||t));return i.setLogger("control"),i.danmu=e,i.main=new a.default(e),e.config.defaultOff||i.main.start(),i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(n,e),o(n,[{key:"createSwitch",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return(this||t).logger&&(this||t).logger.info("createSwitch"),(this||t).switchBtn=(0,s.createDom)("dk-switch",'<span class="txt">弹</span>',{},"danmu-switch "+(e?"danmu-switch-active":"")),(this||t).switchBtn}},{key:"destroy",value:function(){for(var e in(this||t).logger&&(this||t).logger.info("destroy"),(this||t).main.destroy(),this||t)s.hasOwnProperty.call(this||t,e)&&delete(this||t)[e]}}]),n}(r.default);n.default=u,e.exports=n.default},function(e,n,i){Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),r=u(i(1)),a=u(i(29)),s=u(i(30)),l=i(0);function u(t){return t&&t.__esModule?t:{default:t}}var c=function(e){function n(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this||t,n);var i=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this||t,(n.__proto__||Object.getPrototypeOf(n)).call(this||t));return i.setLogger("main"),i.danmu=e,i.container=e.container,i.channel=new s.default(e),i.data=[].concat(e.config.comments),i.playedData=[],i.queue=[],i.timer=null,i.playRate=1,i.retryStatus="normal",i.interval=e.config.interval,i._status="idle",i._events=[],i._bindEvents(),i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(n,e),o(n,[{key:"destroy",value:function(){for(var e in(this||t).logger&&(this||t).logger.info("destroy"),this._unbindEvents(),this._cancelTick(),(this||t).channel&&(this||t).channel.destroy(),(this||t).data=[],(this||t).danmu&&(this||t).danmu.updateGetBoundingCounts&&(this||t).danmu.updateGetBoundingCounts(0),this||t)delete(this||t)[e]}},{key:"_bindEvents",value:function(){var e=this||t,n=(this||t).danmu,i=(this||t).container;this._unbindEvents();(this||t)._events.push([n,"bullet_remove",function(t){var n=t.bullet,i=e.data,o=e.queue;o.some((function(t,e){return t.id===n.id&&(o.splice(e,1),!0)})),i.some((function(t,o){return t.id===n.id&&(t.attached_=!1,e.danmu&&e.danmu.config&&e.danmu.config.postOptimization&&t.prior&&i.splice(o,1),!0)}))}]);((this||t)._events.push([i,"transitionend",function(t){var n=e._getBulletByEvt(t);n&&(n.status="end",n.remove(!1))}]),n.config.mouseControl||n.config.mouseEnterControl)&&(this||t)._events.push([i,"mouseover",function(t){var n,i=e.danmu;!i||i.mouseControl&&i.config.mouseControlPause||(n=e._getBulletByEvt(t))&&"waiting"!==n.status&&"end"!==n.status&&i.emit("bullet_hover",{bullet:n,event:t})}]);(this||t)._events.forEach((function(t){t[0].addEventListener?t[0].addEventListener(t[1],t[2],!1):t[0].on&&t[0].on(t[1],t[2])}))}},{key:"_unbindEvents",value:function(){(this||t)._events.length&&((this||t)._events.forEach((function(t){t[0].removeEventListener?t[0].removeEventListener(t[1],t[2],!1):t[0].off&&t[0].off(t[1],t[2])})),(this||t)._events=[])}},{key:"_cancelTick",value:function(){(this||t).handleTimer&&(clearTimeout((this||t).handleTimer),(this||t).handleTimer=null)}},{key:"_startTickV0",value:function(){var e=this||t;e.retryStatus="normal",e._cancelTick(),e.sortData(),function t(){"closed"!==e._status||"stop"!==e.retryStatus?("playing"===e._status&&(e.readData(),e.dataHandle()),"stop"===e.retryStatus&&"paused"!==e._status||(e.handleTimer=setTimeout(t,250))):e._cancelTick()}()}},{key:"_startTickV1",value:function(){var e=this||t;(this||t).retryStatus="normal",this._cancelTick(),this.sortData();!function t(){"closed"!==e._status||"stop"!==e.retryStatus?("playing"===e._status&&(e.readDataV1(),e.queue.forEach((function(t){"waiting"!==t.status&&"paused"!==t.status||t.startMoveV1()}))),"stop"===e.retryStatus&&"paused"!==e._status||(e.handleTimer=setTimeout(t,250))):e._cancelTick()}()}},{key:"_startTick",value:function(){(this||t).danmu&&(this||t).danmu.config&&(this||t).danmu.config.trackAllocationOptimization?this._startTickV1():this._startTickV0()}},{key:"start",value:function(){(this||t).logger&&(this||t).logger.info("start");"playing"!==(this||t)._status&&((this||t)._status="playing",(this||t).queue=[],(this||t).container.innerHTML="",(this||t).channel.reset(),this._startTick())}},{key:"stop",value:function(){(this||t).logger&&(this||t).logger.info("stop");"closed"!==(this||t)._status&&((this||t)._status="closed",(this||t).retryStatus="stop",(this||t).queue=[],(this||t).container&&((this||t).container.innerHTML=""),(this||t).channel&&(this||t).channel.reset(),this._cancelTick())}},{key:"clear",value:function(){(this||t).logger&&(this||t).logger.info("clear"),(this||t).channel&&(this||t).channel.reset(),(this||t).data=[],(this||t).queue=[],(this||t).container&&((this||t).container.innerHTML="")}},{key:"play",value:function(){var e=this||t;if("closed"!==(this||t)._status){(this||t).logger&&(this||t).logger.info("play"),(this||t)._status="playing";var n=(this||t).channel.channels;n&&n.length>0&&["scroll","top","bottom"].forEach((function(t){e.queue.forEach((function(t){t.startMove(),t.resized=!0}));for(var i=0;i<n.length;i++)n[i].queue[t].forEach((function(t){t.resized=!1}))})),this._startTick()}else(this||t).logger&&(this||t).logger.info("play ignored")}},{key:"pause",value:function(){if("closed"!==(this||t)._status){(this||t).logger&&(this||t).logger.info("pause"),(this||t)._status="paused",this._cancelTick();var e=(this||t).channel.channels;e&&e.length>0&&(this||t).queue.forEach((function(t){t.pauseMove()}))}else(this||t).logger&&(this||t).logger.info("pause ignored")}},{key:"dataHandle",value:function(){"paused"!==(this||t)._status&&"closed"!==(this||t)._status&&(this||t).queue.length&&(this||t).queue.forEach((function(t){"waiting"===t.status&&t.startMove()}))}},{key:"readData",value:function(){var e=(this||t).danmu,n=(this||t).interval,i=(this||t).channel,o=e.player,r=void 0,s=void 0;if(e.isReady&&e.main){if(o){var u=o.currentTime?Math.floor(1e3*o.currentTime):0;s=(this||t).data.filter((function(t){return!t.start&&e.hideArr.indexOf(t.mode)<0&&(!t.color||e.hideArr.indexOf("color")<0)&&(t.start=u),e.config.postOptimization?!t.attached_&&e.hideArr.indexOf(t.mode)<0&&(!t.color||e.hideArr.indexOf("color")<0)&&t.start-n<=u&&(u<=t.start+n||t.prior):!t.attached_&&e.hideArr.indexOf(t.mode)<0&&(!t.color||e.hideArr.indexOf("color")<0)&&t.start-n<=u&&u<=t.start+n})),e.config.postOptimization?s.sort((function(t,e){return t.prior&&!e.prior?-1:!t.prior&&e.prior?1:(e.score||-1)-(t.score||-1)})):e.config.highScorePriority&&s.sort((function(t,e){return e.prior&&!t.prior||(e.score||-1)-(t.score||-1)})),e.live&&((this||t).data=[])}else 0===(s=(this||t).data.splice(0,1)).length&&(s=(this||t).playedData.splice(0,1));if(s.length>0&&i.checkAvailableTrack(s[0].mode)){e&&e.updateReadDataTimes&&e.updateReadDataTimes(),i.updatePos();var c=0;t:for(var h,f=0;f<s.length;f++)if(h=s[f],(this||t).forceDuration&&(this||t).forceDuration!==h.duration&&(h.duration=(this||t).forceDuration),(r=new a.default(e,h)).bulletCreateFail){if(0===c)break t;c--}else if(r.attach(),h.attached_=!0,i.addBullet(r).result)(this||t).queue.push(r),r.topInit(),c=0;else{for(var d in r.detach(),r)l.hasOwnProperty.call(r,d)&&delete r[d];if(r=null,h.attached_=!1,h.noDiscard&&(h.prior?(this||t).data.unshift(h):(this||t).data.push(h)),0===c)break t;c--}}}}},{key:"readDataV1",value:function(){var e=this||t,n=(this||t).danmu,i=(this||t).interval,o=(this||t).channel,r=(this||t).data,s=(this||t).forceDuration,u=n.player;if(n.isReady&&n.main){var c=[];if(u){var h=u.currentTime?Math.floor(1e3*u.currentTime):0;c=r.filter((function(t){return t.start||(t.start=h),n.config.postOptimization?!t.attached_&&t.start-i<=h&&(h<=t.start+i||t.prior):!t.attached_&&t.start-i<=h&&h<=t.start+i})),n.config.postOptimization?c.sort((function(t,e){return t.prior&&!e.prior?-1:!t.prior&&e.prior?1:(e.score||-1)-(t.score||-1)})):n.config.highScorePriority&&c.sort((function(t,e){return e.prior&&!t.prior||(e.score||-1)-(t.score||-1)})),n.live&&((this||t).data=[])}else 0===(c=(this||t).data.splice(0,1)).length&&(c=(this||t).playedData.splice(0,1));if(0!==c.length)for(var f=function(t){n&&n.updateReadDataTimes&&n.updateReadDataTimes();var i=c[t];if(s&&s!==i.duration&&(i.duration=s),!o.checkAvailableTrackV1()||"playing"!==e._status||e.queue&&e.queue.find((function(t){return t.id===i.id})))return"continue";var r=new a.default(n,i);if(r.bulletCreateFail)return"continue";if(r.attachV1(),i.attached_=!0,o.addBulletV1(r)&&"end"!==r.status&&!e.queue.find((function(t){return t.id===i.id})))e.queue.push(r),r.topInit();else{for(var u in r.detach(),r)l.hasOwnProperty.call(r,u)&&delete r[u];i.attached_=!1}},d=0;d<c.length;d++)f(d)}}},{key:"sortData",value:function(){(this||t).data.sort((function(t,e){return(t.start||-1)-(e.start||-1)}))}},{key:"keepPoolWatermark",value:function(){var e=(this||t).danmu,n=e.config,i=e.player,o=(this||t).data,r=[],a=0;if("number"==typeof n.maxCommentsLength&&o.length>n.maxCommentsLength){a=o.length-n.maxCommentsLength;for(var s,l=0;l<a;l++)(s=o[l]).prior&&!s.attached_&&r.push(o[l])}else if(n.dropStaleComments&&i&&i.currentTime){var u=Math.floor(1e3*i.currentTime)-n.interval;if(u>0)for(var c,h=0;h<o.length;h++)if((c=o[h]).prior&&!c.attached_&&r.push(o[h]),c.start>u){a=h;break}}a>0&&(o.splice(0,a),(this||t).data=r.concat(o))}},{key:"_getBulletByEvt",value:function(e){for(var n,i=e.target||e.srcElement,o=(this||t).queue,r=void 0,a=0;a<o.length;a++)if((n=o[a])&&n.el&&(n.el===i||n.el.contains(i))){r=n;break}return r}},{key:"status",get:function(){return(this||t)._status}}]),n}(r.default);n.default=c,e.exports=n.default},function(e,n,i){Object.defineProperty(n,"__esModule",{value:!0}),n.Bullet=void 0;var o=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),r=l(i(1)),a=l(i(4)),s=i(0);function l(t){return t&&t.__esModule?t:{default:t}}function u(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function c(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}var h=new a.default("bullet"),f=n.Bullet=function(e){function n(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};u(this||t,n);var o=c(this||t,(n.__proto__||Object.getPrototypeOf(n)).call(this||t)),r=e.container,a=e.recycler,s=e.config;return o.setLogger(h),o.danmu=e,o.options=i,o.duration=i.duration,o.id=i.id,o.container=r,o.mode="top"===i.mode||"bottom"===i.mode?i.mode:"scroll",o.start=i.start,o.prior=i.prior,o.realTime=i.realTime,o.color=i.color,o.bookChannelId=i.bookChannelId,o.reuseDOM=!0,o.noCopyEl=!(!s.disableCopyDOM&&!i.disableCopyDOM),o.recycler=a,o._fullySlideInScreenDuration=void 0,o._lastMoveTime=void 0,o.status="waiting",i.elLazyInit||(o.bulletCreateFail=!o._makeEl()),o.startsTime=0,o.fullEnterTime=0,o.fullLeaveTime=0,o.waitTimeStamp=0,o}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(n,e),o(n,[{key:"_makeEl",value:function(){var e=(this||t).danmu,n=(this||t).options,i=e.config,o=e.globalHooks,r=void 0,a="",l=n.style||{};if(l.perspective="500em",n.el||n.elLazyInit){if((this||t).noCopyEl&&((this||t).reuseDOM=!1),n.elLazyInit){if((0,s.isFunction)(o.bulletCreateEl))try{var u=o.bulletCreateEl(n);e&&e.updateDanmuElCreateCounts&&e.updateDanmuElCreateCounts(),r=u instanceof HTMLElement?u:u.el}catch(e){}}else if(1===n.el.nodeType&&!n.el.parentNode)if((this||t).reuseDOM){var c=(0,s.copyDom)(n.el);n.eventListeners&&n.eventListeners.length>0&&n.eventListeners.forEach((function(t){c.addEventListener(t.event,t.listener,t.useCapture||!1)})),(r=(this||t).recycler.use()).childNodes.length>0&&(r.innerHTML=""),r.textContent&&(r.textContent=""),r.appendChild(c)}else r=n.el}else"string"==typeof n.txt&&((r=(this||t).recycler.use()).textContent=n.txt);if(!r||!e.main)return!1;var h=void 0;if((0,s.isNumber)(i.bulletOffset)&&i.bulletOffset>=0)h=i.bulletOffset;else{var f=e.containerPos;h=f.width/10>100?100:f.width/10}var d=n.realTime?0:Math.floor(Math.random()*h),p=this.updateOffset(d,!0);return l.left=p,Object.keys(l).forEach((function(t){var e=t.replace(/[A-Z]/g,(function(t){return"-"+t.toLowerCase()}));a+=e+":"+l[t]+";"})),(0,s.styleCSSText)(r,a),(this||t).el=r,n.like&&n.like.el&&this.setLikeDom(n.like.el,n.like.style),!0}},{key:"_makeElV1",value:function(){var e=(this||t).danmu,n=(this||t).options,i=e.globalHooks,o=void 0,r="",a=n.style||{};if(a.position="absolute",(this||t).reuseDOM=!1,n.elLazyInit&&(0,s.isFunction)(i.bulletCreateEl))try{var l=i.bulletCreateEl(n);e&&e.updateDanmuElCreateCounts&&e.updateDanmuElCreateCounts(),o=l instanceof HTMLElement?l:l.el}catch(e){console.log("danmakulogger","创建dom元素失败",n)}return!(!o||!e.main)&&(a.left=this.updateOffset(0,!0),Object.keys(a).forEach((function(t){var e=t.replace(/[A-Z]/g,(function(t){return"-"+t.toLowerCase()}));r+=e+":"+a[t]+";"})),(0,s.styleCSSText)(o,r),(this||t).el=o,!0)}},{key:"updateOffset",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];(this||t).random=e;var i=(this||t).danmu.containerPos.width+e+"px";return n||(0,s.styleUtil)((this||t).el,"left",(this||t).danmu.containerPos.width+e+"px"),i}},{key:"updatePosition",value:function(){return(this||t).el?((this||t).elPos=(this||t).el.getBoundingClientRect(),(this||t).width=(this||t).elPos.width,(this||t).options.width=(this||t).elPos.width,(this||t).danmu&&(this||t).danmu.updateGetBoundingCounts&&(this||t).danmu.updateGetBoundingCounts(),(this||t).el&&(this||t).el.style&&(this||t).el.style.fontSize&&((this||t).danmu.fontSizeItem=(this||t).el.style.fontSize),(this||t).elPos):{}}},{key:"attach",value:function(){if((this||t).options.elLazyInit&&!(this||t).el&&this._makeEl(),(this||t).danmu&&(this||t).danmu.main){var e=(this||t).danmu,n=(this||t).options,i=(this||t).el,o=e.globalHooks;o.bulletAttaching&&o.bulletAttaching(n),(this||t).container.contains(i)||(this||t).container.appendChild(i),(this||t).elPos=i.getBoundingClientRect(),e&&e.updateGetBoundingCounts&&e.updateGetBoundingCounts(),"b2t"===(this||t).direction?((this||t).width=(this||t).elPos.height,(this||t).height=(this||t).elPos.width):((this||t).width=(this||t).elPos.width,(this||t).height=(this||t).elPos.height),(this||t).moveV&&((this||t).duration=((this||t).danmu.containerPos.width+(this||t).random+(this||t).width)/(this||t).moveV*1e3),o.bulletAttached&&o.bulletAttached(n,i)}}},{key:"attachV1",value:function(){var e=(this||t).danmu,n=(this||t).options,i=e.globalHooks;if(n.elLazyInit&&!(this||t).el&&this._makeElV1(),e&&e.main){var o=(this||t).el;o instanceof Element&&!(this||t).container.contains(o)&&(this||t).container.appendChild(o),(this||t).width||this.updatePosition(),i.bulletAttached&&i.bulletAttached(n,(this||t).el)}}},{key:"detach",value:function(){var e=(this||t).el,n=(this||t).danmu,i=(this||t).options,o=n.globalHooks;e&&(o.bulletDetaching&&o.bulletDetaching(i),(this||t).reuseDOM?(this||t).recycler.unused(e):e.parentNode&&e.parentNode.removeChild(e),o.bulletDetached&&o.bulletDetached(i,e),(this||t).el=null),(this||t).elPos=void 0}},{key:"topInit",value:function(){(this||t).logger&&(this||t).logger.info("topInit #"+((this||t).options.txt||"[DOM Element]")+"#"),"b2t"===(this||t).direction?((0,s.styleUtil)((this||t).el,"transformOrigin","left top"),(0,s.styleUtil)((this||t).el,"transform","translateX(-"+(this||t).top+"px) translateY("+(this||t).danmu.containerPos.height+"px) translateZ(0px) rotate(90deg)"),(0,s.styleUtil)((this||t).el,"transition","transform 0s linear 0s")):(0,s.styleUtil)((this||t).el,"top",(this||t).top+"px")}},{key:"pauseMove",value:function(e){(this||t).danmu&&(this||t).danmu.config&&(this||t).danmu.config.trackAllocationOptimization?this.pauseMoveV1():this.pauseMoveV0(e)}},{key:"pauseMoveV0",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=this||t;if("paused"!==n.status&&("forcedPause"!==n.status&&((this||t).status="paused"),n._moveV=void 0,(this||t).el))if("scroll"===(this||t).mode){var i=n.danmu.containerPos;if(e){var o=((new Date).getTime()-n._lastMoveTime)/1e3,r=o*(this||t).moveV,a=0;a=n.moveMoreS-r>=0?"b2t"===(this||t).direction?(n.moveMoreS-r)/n.moveContainerHeight*i.height:(n.moveMoreS-r)/n.moveContainerWidth*i.width:n.moveMoreS-r,"b2t"===(this||t).direction?(0,s.styleUtil)((this||t).el,"transform","translateX(-"+(this||t).top+"px) translateY("+a+"px) translateZ(0px) rotate(90deg)"):(0,s.styleUtil)((this||t).el,"left",a+"px")}else"b2t"===(this||t).direction?(0,s.styleUtil)((this||t).el,"transform","translateX(-"+(this||t).top+"px) translateY("+((this||t).el.getBoundingClientRect().top-i.top)+"px) translateZ(0px) rotate(90deg)"):((0,s.styleUtil)((this||t).el,"left",(this||t).el.getBoundingClientRect().left-i.left+"px"),n.danmu&&n.danmu.updateGetBoundingCounts&&n.danmu.updateGetBoundingCounts());"b2t"===(this||t).direction||(0,s.styleUtil)((this||t).el,"transform","translateX(0px) translateY(0px) translateZ(0px)"),(0,s.styleUtil)((this||t).el,"transition","transform 0s linear 0s")}else(this||t).pastDuration&&(this||t).startTime?(this||t).pastDuration=(this||t).pastDuration+(new Date).getTime()-(this||t).startTime:(this||t).pastDuration=1}},{key:"pauseMoveV1",value:function(){if("paused"!==(this||t).status&&(this||t).el){"forcedPause"!==(this||t).status&&((this||t).status="paused");var e=(this||t).danmu.containerPos;(this||t).recalculate=!0;var n=this.updatePosition();(0,s.styleUtil)((this||t).el,"left",n.left-e.left+"px"),(0,s.styleUtil)((this||t).el,"transform","translateX(0px) translateY(0px) translateZ(0px)"),(0,s.styleUtil)((this||t).el,"transition","transform 0s linear 0s"),n.right<=e.right&&((this||t).fullEnterTime=-1),n.right<e.left&&this.remove(!1)}}},{key:"startMove",value:function(e){(this||t).danmu&&(this||t).danmu.config&&(this||t).danmu.config.trackAllocationOptimization?this.startMoveV1(e):this.startMoveV0(e)}},{key:"startMoveV0",value:function(e){if((this||t).hasMove||((this||t).danmu.emit("bullet_start",this||t),(this||t).hasMove=!0),("forcedPause"!==(this||t).status||e)&&(this||t).el&&"start"!==(this||t).status)if((this||t).status="start","scroll"===(this||t).mode){var n=(this||t).danmu.containerPos;if(!(this||t).el)return;var i=(this||t).el.getBoundingClientRect();(this||t).danmu&&(this||t).danmu.updateGetBoundingCounts&&(this||t).danmu.updateGetBoundingCounts();var o=void 0;if("b2t"===(this||t).direction){o=i.bottom-n.bottom;var r=(i.bottom-n.top)/(this||t).moveV;(0,s.styleUtil)((this||t).el,"transition","transform "+r+"s linear 0s"),(0,s.styleUtil)((this||t).el,"transform","translateX(-"+(this||t).top+"px) translateY(-"+(this||t).height+"px) translateZ(0px) rotate(90deg)"),(this||t)._lastMoveTime=(new Date).getTime(),(this||t).moveMoreS=i.top-n.top,(this||t).moveContainerHeight=n.height}else{o=i.right-n.right;var a=i.right-n.left,l=a/(this||t).moveV;(this||t).danmu&&(this||t).danmu.updateStartMoveTimes&&(this||t).danmu.updateStartMoveTimes(),i.right>n.left?((0,s.styleUtil)((this||t).el,"transition","transform "+l+"s linear 0s"),(0,s.styleUtil)((this||t).el,"transform","translateX(-"+a+"px) translateY(0px) translateZ(0px)"),(this||t)._lastMoveTime=(new Date).getTime(),(this||t).moveMoreS=i.left-n.left,(this||t).moveContainerWidth=n.width):((this||t).status="end",this.remove())}(this||t)._fullySlideInScreenDuration=o/(this||t).moveV}else{var u=(new Date).getTime(),c=((this||t).startTime&&u-(this||t).startTime>(this||t).duration?u-(this||t).startTime:(this||t).duration)/1e3;(0,s.styleUtil)((this||t).el,"left","50%"),(0,s.styleUtil)((this||t).el,"margin","0 0 0 -"+(this||t).width/2+"px"),(0,s.styleUtil)((this||t).el,"visibility","hidden"),(0,s.styleUtil)((this||t).el,"transition","visibility "+c+"s 0s"),(this||t).pastDuration||((this||t).pastDuration=1),(this||t).startTime=u}}},{key:"startMoveV1",value:function(e){var n=(this||t).status;if("visible"!==document.visibilityState&&"paused"!==n&&"forcedPause"!==n&&!(this||t).recalculate)return(this||t).waitTimeStamp=0,this.remove(!1),void((this||t).status="end");var i=(0,s.getTimeStamp)();if((this||t).el&&!((this||t).waitTimeStamp>i)){if((this||t).recalculate);else{if("start"===n||"forcedPause"===n&&!e)return;if("forcedPause"!==n&&"paused"!==n&&(this||t).fullLeaveTime&&(this||t).fullLeaveTime<i)return this.remove(!1),void((this||t).status="end")}(this||t).waitTimeStamp=0;var o=(this||t).danmu.containerPos;if((this||t).status="start",(this||t).danmu&&(this||t).danmu.updateStartMoveTimes&&(this||t).danmu.updateStartMoveTimes(),"paused"===n||"forcedPause"===n||(this||t).recalculate){var r=this.updatePosition(),a=r.right-o.left,l=a/(this||t).moveVV1;r.right>o.left?((0,s.styleUtil)((this||t).el,"transition","transform "+l/1e3+"s linear 0s"),(0,s.styleUtil)((this||t).el,"transform","translateX(-"+a+"px) translateY(0px) translateZ(0px)"),r.right>o.right?(this||t).fullEnterTime=i+(r.right-o.right)/(this||t).moveVV1:(this||t).fullEnterTime=-1,(this||t).fullLeaveTime=i+l):((this||t).status="end",this.remove(!1))}else{var u=(this||t).el;(0,s.styleUtil)(u,"transition","transform "+(this||t).duration/1e3+"s linear 0s"),(0,s.styleUtil)(u,"transform","translateX(-"+(o.width+(this||t).width)+"px) translateY(0px) translateZ(0px)"),(this||t).startsTime=(0,s.getTimeStamp)(),(this||t).endTime=(this||t).startsTime+(this||t).duration,(this||t).fullEnterTime=(this||t).startsTime+(this||t).width/(this||t).moveVV1,(this||t).fullLeaveTime=(this||t).startsTime+(this||t).duration}}}},{key:"remove",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];(this||t).logger&&(this||t).logger.info("remove #"+((this||t).options.txt||"[DOM Element]")+"#");var n=this||t;(this||t).fullEnterTime=-1,e&&n.pauseMove(),n.el&&n.el.parentNode&&(n.detach(),(this||t).options.el&&1===(this||t).options.el.nodeType&&(this||t).noCopyEl&&(0,s.styleUtil)((this||t).options.el,"transform","none"),n.danmu.emit("bullet_remove",{bullet:n}))}},{key:"setFontSize",value:function(e){(this||t).el&&((this||t).el.style.fontSize=e),(this||t).danmu&&(this||t).danmu.config&&(this||t).danmu.config.fontSizeAdjust&&((this||t).el.style.height=e)}},{key:"setLikeDom",value:function(e,n){if(e){Object.keys(n).forEach((function(t){e.style[t]=n[t]}));if(e.className="danmu-like",(this||t).el){var i=(this||t).el.querySelector(".danmu-like");i&&(this||t).el.removeChild(i),(this||t).el.innerHTML=""+(this||t).el.innerHTML+e.outerHTML}}return e}},{key:"moveV",get:function(){var e=(this||t).danmu,n=(this||t).options,i=(this||t)._moveV;if(!i){if(n.moveV)i=n.moveV;else if((this||t).elPos){var o=e.containerPos;i=("b2t"===(this||t).direction?o.height+(e.config.chaseEffect?(this||t).height:0):o.width+(e.config.chaseEffect?(this||t).width:0))/(this||t).duration*1e3}i&&(i*=e.main.playRate,(this||t)._moveV=i)}return i}},{key:"moveVV1",get:function(){return!(this||t).width&&(this||t).el&&(this.updatePosition(),(this||t).options.width=(this||t).width),(((this||t).danmu.containerPos.width||0)+(this||t).width)/(this||t).duration}},{key:"direction",get:function(){return(this||t).danmu.direction}},{key:"fullySlideIntoScreen",get:function(){var e=!0;"scroll"===(this||t).mode&&(this||t)._lastMoveTime&&(this||t)._fullySlideInScreenDuration>0&&(e=((new Date).getTime()-(this||t)._lastMoveTime)/1e3>=(this||t)._fullySlideInScreenDuration);return e}}]),n}(r.default);n.default=f},function(e,n,i){Object.defineProperty(n,"__esModule",{value:!0});var o,r=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),a=i(1),s=(o=a)&&o.__esModule?o:{default:o},l=i(0),u=i(31);function c(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}var h=function(e){function n(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this||t,n);var i=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this||t,(n.__proto__||Object.getPrototypeOf(n)).call(this||t)),o=i;return o.setLogger("channel"),o.danmu=e,o.width=0,o.height=0,o.reset(!0),o.channels=[],o.updatePos(),(0,l.attachEventListener)(i.danmu,"bullet_remove",(function(t){t.bullet.danmu.config.trackAllocationOptimization?o.removeBulletV1(t.bullet):o.removeBullet(t.bullet)}),"destroy"),(0,l.attachEventListener)(i.danmu,"channel_resize",(function(){o.resize()}),"destroy"),i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(n,e),r(n,[{key:"checkAvailableTrack",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"scroll",n=(this||t).channels,i=!1;if("scroll"===e)for(var o,r=0;r<n.length;r++)if(i=!0,(o=n[r]).operating[e])i=!1;else{var a=o.queue[e][0];if(!a||a.fullySlideIntoScreen){if(i)break}else i=!1}else i=!0;return i}},{key:"checkAvailableTrackV1",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"scroll";if("visible"!==document.visibilityState)return!1;var n=(this||t).channels.findIndex((function(t){var n=t.queue[e][0];return!t.freeze&&(!(n&&!(n.fullEnterTime&&n.fullEnterTime<=(0,l.getTimeStamp)()))||void 0)}));return n>=0}},{key:"destroy",value:function(){for(var e in(this||t).logger&&(this||t).logger.info("destroy"),(this||t).channels.splice(0,(this||t).channels.length),this._cancelResizeTimer(),this||t)l.hasOwnProperty.call(this||t,e)&&delete(this||t)[e]}},{key:"reset",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(this||t).logger&&(this||t).logger.info("reset");var n=this||t,i=n.danmu,o=i.container,r=i.bulletBtn;function a(){if(n.danmu&&n.danmu.container){var t=n.danmu.container.getBoundingClientRect();n.danmu.updateGetBoundingCounts&&n.danmu.updateGetBoundingCounts(),n.width=t.width,n.height=t.height,n.resetId&&(cancelAnimationFrame(n.resetId),n.resetId=null);var e=n._initChannels(),i=e.channelSize,o=e.channelCount,r=e.channels;n.channelCount=o,n.channels=r,"b2t"===n.direction?n.channelWidth=i:n.channelHeight=i}}n.container=o,r&&r.main&&r.main.queue.forEach((function(t){t.remove()})),n.channels&&n.channels.length>0&&["scroll","top","bottom"].forEach((function(t){for(var e=0;e<n.channels.length;e++)n.channels[e].queue[t].forEach((function(t){t.remove()}))})),r&&r.main&&r.main.data&&r.main.data.forEach((function(t){t.attached_=!1})),e?(this||t).resetId=requestAnimationFrame(a):a()}},{key:"getRealOccupyArea",value:function(){return{width:(this||t).width,height:(this||t).height}}},{key:"updatePos",value:function(){var e=(this||t).container.getBoundingClientRect();(this||t).danmu&&(this||t).danmu.updateGetBoundingCounts&&(this||t).danmu.updateGetBoundingCounts(),(this||t).containerPos=e,(this||t).containerWidth=e.width,(this||t).containerHeight=e.height,(this||t).containerTop=e.top,(this||t).containerBottom=e.bottom,(this||t).containerLeft=e.left,(this||t).containerRight=e.right}},{key:"addBullet",value:function(e){var n=this||t,i=(this||t).danmu,o=(this||t).channels,r=void 0,a=void 0,s=void 0;if("b2t"===n.direction?(a=(this||t).channelWidth,s=Math.ceil(e.width/a)):(r=(this||t).channelHeight,s=Math.ceil(e.height/r)),s>o.length)return{result:!1,message:"exceed channels.length, occupy="+s+",channelsSize="+o.length};for(var l=!0,u=void 0,c=-1,h=0,f=o.length;h<f;h++)if(o[h].queue[e.mode].some((function(t){return t.id===e.id})))return{result:!1,message:"exited, channelOrder="+h+",danmu_id="+e.id};if("scroll"===e.mode)for(var d=0,p=o.length-s;d<=p;d+=s){l=!0;for(var m=d;m<d+s;m++){if((u=o[m]).operating.scroll||u.bookId.scroll&&u.bookId.scroll!==e.id){l=!1;break}u.operating.scroll=!0;var v=u.queue.scroll[0];if(v){var g=v.el.getBoundingClientRect();if(i&&i.updateGetBoundingCounts&&i.updateGetBoundingCounts(),"b2t"===n.direction){if(g.bottom>=n.containerPos.bottom){l=!1,u.operating.scroll=!1;break}}else if(g.right>=n.containerPos.right){l=!1,u.operating.scroll=!1;break}var y=void 0,b=v.moveV,_=void 0,k=e.moveV,w=void 0;if("b2t"===n.direction?(_=(y=g.bottom-n.containerTop)/b,w=n.containerHeight+e.random-y):(_=(y=g.right-n.containerLeft)/b,w=n.containerWidth+e.random-y),k>b){var O=w/(k-b);if(i.config.bOffset||(i.config.bOffset=0),_+i.config.bOffset>=O){var T=_*k-n.containerPos.width;T>0&&e.updateOffset(T+(1+Math.ceil(5*Math.random())))}}}u.operating.scroll=!1}if(l){c=d;break}}else if("top"===e.mode)for(var C=0,x=o.length-s;C<=x;C++){l=!0;for(var S=C;S<C+s;S++){if(S>Math.floor(o.length/2)){l=!1;break}if((u=o[S]).operating[e.mode]){l=!1;break}if((u.bookId[e.mode]||e.prior)&&u.bookId[e.mode]!==e.id){l=!1;break}if(u.operating[e.mode]=!0,u.queue[e.mode].length>0){l=!1,u.operating[e.mode]=!1;break}u.operating[e.mode]=!1}if(l){c=C;break}}else if("bottom"===e.mode)for(var E=o.length-s;E>=0;E--){l=!0;for(var z=E;z<E+s;z++){if(z<=Math.floor(o.length/2)){l=!1;break}if((u=o[z]).operating[e.mode]){l=!1;break}if((u.bookId[e.mode]||e.prior)&&u.bookId[e.mode]!==e.id){l=!1;break}if(u.operating[e.mode]=!0,u.queue[e.mode].length>0){l=!1,u.operating[e.mode]=!1;break}u.operating[e.mode]=!1}if(l){c=E;break}}if(-1!==c){i&&i.updateAttachTimes&&i.updateAttachTimes();for(var M=c,P=c+s;M<P;M++)(u=o[M]).operating[e.mode]=!0,u.queue[e.mode].unshift(e),e.prior&&(delete u.bookId[e.mode],n.logger&&n.logger.info(M+"号轨道恢复正常使用")),u.operating[e.mode]=!1;e.prior&&(n.logger&&n.logger.info(e.id+"号优先弹幕运行完毕"),delete e.bookChannelId,i.player)&&i.bulletBtn.main.data.some((function(t){return t.id===e.id&&(delete t.bookChannelId,!0)}));return e.channel_id=[c,s],e.el.setAttribute("data-line-index",c+1),"b2t"===n.direction?(e.top=c*a,n.danmu.config.area&&n.danmu.config.area.start&&(e.top+=n.containerWidth*n.danmu.config.area.start)):(e.top=c*r,n.danmu.config.area&&n.danmu.config.area.start&&(e.top+=n.containerHeight*n.danmu.config.area.start)),{result:e,message:"success"}}if(e.options.realTime){var L=0,j=-1,D=null;if(n.danmu.bulletBtn.main.queue.forEach((function(t,e){!t.prior&&!t.options.realTime&&t.el&&t.el.getBoundingClientRect().left>n.containerPos.right&&t.start>=L&&(L=t.start,j=e,D=t)})),D){D.remove(),n.removeBullet(D),n.danmu.bulletBtn.main.queue.splice(j,1),e.channel_id=D.channel_id;for(var A=D.channel_id[0],V=D.channel_id[0]+D.channel_id[1];A<V;A++)(u=o[A]).operating[e.mode]=!0,u.queue[e.mode].unshift(e),e.prior&&delete u.bookId[e.mode],u.operating[e.mode]=!1;return e.top=D.top,n.danmu.config.area&&n.danmu.config.area.start&&(e.top+=n.containerHeight*n.danmu.config.area.start),{result:e,message:"success"}}}if(e.prior)if(e.bookChannelId||n.danmu.live)i.player&&i.bulletBtn.main.data.some((function(t){return t.id===e.id&&(n.logger&&n.logger.info(e.id+"号优先弹幕将于2秒后再次请求注册"),t.start+=2e3,!0)}));else{c=-1;for(var I=0,B=o.length-s;I<=B;I++){l=!0;for(var q=I;q<I+s;q++)if(o[q].bookId[e.mode]){l=!1;break}if(l){c=I;break}}if(-1!==c){for(var R=c;R<c+s;R++)o[R].bookId[e.mode]=e.id,n.logger&&n.logger.info(R+"号轨道被"+e.id+"号优先弹幕预定");i.player&&i.bulletBtn.main.data.some((function(t){return t.id===e.id&&(n.logger&&n.logger.info(e.id+"号优先弹幕将于2秒后再次请求注册"),t.start+=2e3,t.bookChannelId=[c,s],n.logger&&n.logger.info(e.id+"号优先弹幕预定了"+c+"~"+(c+s-1)+"号轨道"),!0)}))}}return{result:!1,message:"no surplus will right"}}},{key:"addBulletV1",value:function(e){for(var n=-1,i=(0,l.getTimeStamp)(),o=0;o<(this||t).channels.length;o++){var r=(this||t).channels[o];if(!r.freeze){var a=r.queue.scroll[0];if(!a||!a.el){n=r.id;break}if(a.recalculate){var s=a.updatePosition();if((this||t).containerRight>s.right){var u=a.fullLeaveTime-i-(this||t).containerWidth/e.moveVV1;e.waitTimeStamp=u>=0?i+u:0,n=r.id;break}}else{if(a.waitTimeStamp||!a.startsTime||!a.fullEnterTime)continue;if(a.fullEnterTime<i){if(a.moveVV1>e.moveVV1){n=r.id;break}var c=a.fullLeaveTime-i-(this||t).containerWidth/e.moveVV1;n=r.id,c>0&&(e.waitTimeStamp=i+c);break}}}}return n>-1&&((this||t).danmu&&(this||t).danmu.updateAttachTimes&&(this||t).danmu.updateAttachTimes(),(this||t).channels[n].queue.scroll.unshift(e),e.channelIndex=n,e.top=n*(this||t).channelHeight,e.channelId=n,e.startMoveV1(),!0)}},{key:"removeBullet",value:function(e){(this||t).logger&&(this||t).logger.info("removeBullet "+(e.options.txt||"[DOM Element]"));for(var n=(this||t).channels,i=e.channel_id,o=void 0,r=i[0],a=i[0]+i[1];r<a;r++)if(o=n[r]){o.operating[e.mode]=!0;var s=-1;o.queue[e.mode].some((function(t,n){return t.id===e.id&&(s=n,!0)})),s>-1&&o.queue[e.mode].splice(s,1),o.operating[e.mode]=!1}e.options.loop&&(this||t).danmu.bulletBtn.main.playedData.push(e.options)}},{key:"removeBulletV1",value:function(e){if(e&&void 0!==e.channelId&&(this||t).channels[e.channelId]){var n=(this||t).channels[e.channelId];n.operating[e.mode]=!0;for(var i=n.queue[e.mode],o=i.length-1;o>=0;o--)if(i[o].id===e.id){i.splice(o,1),n.operating[e.mode]=!1;break}}e.options.loop&&(this||t).danmu.bulletBtn.main.playedData.push(e.options)}},{key:"resizeSync",value:function(){this.resize(!0)}},{key:"_initChannels",value:function(e){return(this||t).danmu&&(this||t).danmu.config&&(this||t).danmu.config.trackAllocationOptimization?this._initChannelsV1(e):this._initChannelsV0(e)}},{key:"_initChannelsV0",value:function(e){if((this||t).danmu&&(this||t).danmu.config){var n=(this||t).danmu.config,i=e||n.channelSize||(/mobile/gi.test(navigator.userAgent)?10:12),o=void 0;if(n.area){var r=n.area,a=r.lines,s=r.start,c=r.end;if((0,u.validAreaLineRule)(a))o=a,"b2t"===(this||t).direction?(this||t).width=o*i:(this||t).height=o*i;else if(s>=0&&c>=s){var h=c-s;"b2t"===(this||t).direction?(this||t).width=Math.floor((this||t).width*h):(this||t).height=Math.floor((this||t).height*h)}}(0,l.isNumber)(o)||(o="b2t"===(this||t).direction?Math.floor((this||t).width/i):Math.floor((this||t).height/i));for(var f=[],d=0;d<o;d++)f[d]={id:d,queue:{scroll:[],top:[],bottom:[]},operating:{scroll:!1,top:!1,bottom:!1},bookId:{}};return{channelSize:i,channelCount:o,channels:f}}}},{key:"_initChannelsV1",value:function(e){if((this||t).danmu&&(this||t).danmu.config){var n=(this||t).danmu.config,i=e||n.channelSize||(/mobile/gi.test(navigator.userAgent)?10:12),o=void 0;if(n.area){var r=n.area,a=r.lines,s=r.start,l=r.end;(0,u.validAreaLineRule)(a)?(o=Number(a),(this||t).height=o*i):s>=0&&l>=s&&((this||t).height=Math.floor((this||t).containerHeight*(l-s)),o=Math.floor((this||t).height/i))}for(var c=[],h=0;h<o;h++)c[h]={id:h,queue:{scroll:[],top:[],bottom:[]},operating:{scroll:!1,top:!1,bottom:!1},bookId:{}};return{channelSize:i,channelCount:o,channels:c}}}},{key:"resize",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return(this||t).danmu&&(this||t).danmu.config&&(this||t).danmu.config.trackAllocationOptimization?this.resizeV1(e):this.resizeV0(e)}},{key:"resizeV0",value:function(e){(this||t).logger&&(this||t).logger.info("resize");var n=this||t;function i(t,e){t[e]={id:e,queue:{scroll:[],top:[],bottom:[]},operating:{scroll:!1,top:!1,bottom:!1},bookId:{}}}function o(){var t=n.danmu,e=t.container,o=t.bulletBtn;n.container=e,n.updatePos(),n._cancelResizeTimer(),o.main.data&&o.main.data.forEach((function(t){t.bookChannelId&&(delete t.bookChannelId,n.logger&&n.logger.info("resize导致"+t.id+"号优先弹幕预定取消"))})),n.logger&&n.logger.info("resize导致所有轨道恢复正常使用"),n.width=n.containerWidth,n.height=n.containerHeight;var r=n._initChannels(),a=r.channelSize,s=r.channels;n.channels&&(n.channels.length<=s.length?function(t,e){function o(e){["scroll","top"].forEach((function(i){n.channels[e].queue[i].forEach((function(n){n.el&&t[e].queue[i].push(n)}))}))}function r(i){n.channels[i].queue.bottom.forEach((function(o){if(o.el&&(t[i+t.length-n.channels.length].queue.bottom.push(o),o.channel_id[0]+o.channel_id[1]-1===i)){var r=[].concat(o.channel_id);o.channel_id=[r[0]-n.channels.length+t.length,r[1]],o.top=o.channel_id[0]*e,n.danmu.config.area&&n.danmu.config.area.start&&(o.top+=n.containerHeight*n.danmu.config.area.start),o.topInit()}}))}for(var a=0;a<n.channels.length;a++)i(t,a),o(a),r(a);for(var s=function(e){["scroll","top","bottom"].forEach((function(n){t[e].queue[n].forEach((function(t){t.resized=!1}))}))},l=0;l<t.length;l++)s(l);n.channels=t,"b2t"===n.direction?n.channelWidth=e:n.channelHeight=e}(s,a):function(t,e){for(var o=["scroll","top","bottom"],r=function(r){i(t,r),o.forEach((function(i){if("top"===i&&r>Math.floor(t.length/2));else if("bottom"===i&&r<=Math.floor(t.length/2));else{var o="bottom"===i?r-t.length+n.channels.length:r;n.channels[o].queue[i].forEach((function(a,s){if(a.el){if(t[r].queue[i].push(a),"bottom"===i&&a.channel_id[0]+a.channel_id[1]-1===o){var l=[].concat(a.channel_id);a.channel_id=[l[0]-n.channels.length+t.length,l[1]],a.top=a.channel_id[0]*e,n.danmu.config.area&&n.danmu.config.area.start&&(a.top+=n.containerHeight*n.danmu.config.area.start),a.topInit()}n.channels[o].queue[i].splice(s,1)}}))}}))},a=0;a<t.length;a++)r(a);var s=function(e){o.forEach((function(n){t[e].queue[n].forEach((function(t){t.resized=!1}))}))};for(a=0;a<t.length;a++)s(a);n.channels=t,"b2t"===n.direction?n.channelWidth=e:n.channelHeight=e}(s,a)),n.resizing=!1}n.resizing||(n.resizing=!0,e?o():(this._cancelResizeTimer(),(this||t).resizeId=requestAnimationFrame(o)))}},{key:"updateChannlState",value:function(e){var n=this._initChannels(e),i=n.channelCount,o=n.channels,r=n.channelSize,a=(this||t).channels,s=a.filter((function(t){return!t.freeze}));if(a){var l=s.length;s.length<i?(this||t).channels=[].concat(c(s),c(o.slice(l))):(a.forEach((function(t,e){return t.freeze=Boolean(e>=i)})),(this||t).channels=a)}else(this||t).channels=o;(this||t).channelHeight=r}},{key:"resizeV1",value:function(e){this.updatePos(),(this||t).width=(this||t).containerWidth,(this||t).height=(this||t).containerHeight,(this||t).danmu.main.queue.forEach((function(t){t.recalculate=!0})),this.updateChannlState(),(this||t).danmu&&(this||t).danmu.main&&(this||t).danmu.main.queue&&((this||t).danmu.main.queue.forEach((function(t){t.pauseMove()})),(this||t).danmu&&(this||t).danmu.updateQueueTimestamp&&(this||t).danmu.updateQueueTimestamp())}},{key:"_cancelResizeTimer",value:function(){(this||t).resizeId&&(cancelAnimationFrame((this||t).resizeId),(this||t).resizeId=null)}},{key:"direction",get:function(){return(this||t).danmu.direction}}]),n}(s.default);n.default=h,e.exports=n.default},function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0}),e.validAreaLineRule=function(t){return"number"==typeof t&&t>=0&&Number.isInteger(t)}},function(e,n,i){Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),r=i(0);var a=function(){function e(n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this||t,e),n={initDOM:function(){return document.createElement("div")},initSize:10},this.init(n)}return o(e,[{key:"init",value:function(e){(this||t).idleList=[],(this||t).usingList=[],(this||t)._id=0,(this||t).options=e,this._expand(e.initSize)}},{key:"use",value:function(){(this||t).idleList.length||this._expand(1);var e=(this||t).idleList.shift();return(this||t).usingList.push(e),e}},{key:"unused",value:function(e){var n=(this||t).usingList.indexOf(e);n<0||((this||t).usingList.splice(n,1),e.style.opacity=0,(this||t).idleList.push(e))}},{key:"_expand",value:function(e){for(var n=0;n<e;n++)(this||t).idleList.push((this||t).options.initDOM((this||t)._id++))}},{key:"destroy",value:function(){for(var e=0;e<(this||t).idleList.length;e++)(this||t).idleList[e].innerHTML="",(this||t).idleList[e].textcontent="",this.clearElementStyle((this||t).idleList[e]);for(var n=0;n<(this||t).usingList.length;n++)(this||t).usingList[n].innerHTML="",(this||t).usingList[n].textcontent="",this.clearElementStyle((this||t).usingList[n]);for(var i in this||t)r.hasOwnProperty.call(this||t,i)&&delete(this||t)[i]}},{key:"clearElementStyle",value:function(t){var e="undefined"!=typeof window?window.navigator.userAgent:null;e&&(e.indexOf("MSIE ")>-1||e.indexOf("Trident/")>-1?(0,r.styleUtil)(t,"transform","none"):t.setAttribute("style",""))}}]),e}();n.default=a,e.exports=n.default},function(e,n,i){Object.defineProperty(n,"__esModule",{value:!0}),n.destroyObserver=n.unObserver=n.addObserver=void 0;var o=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),r=i(0);var a=new(function(){function e(){var n=this||t;if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this||t,e),(this||t).__handlers=[],window.ResizeObserver)try{(this||t).observer=new window.ResizeObserver((0,r.throttle)((function(t){n.__trigger(t)}),100))}catch(t){}}return o(e,[{key:"addObserver",value:function(e,n){if((this||t).observer&&e){(this||t).observer&&(this||t).observer.observe(e);for(var i=(this||t).__handlers,o=-1,r=0;r<i.length;r++)i[r]&&e===i[r].target&&(o=r);o>-1?(this||t).__handlers[o].handler.push(n):(this||t).__handlers.push({target:e,handler:[n]})}}},{key:"unObserver",value:function(e){if(e){var n=-1;(this||t).__handlers.map((function(t,i){e===t.target&&(n=i)})),(this||t).observer&&(this||t).observer.unobserve(e),n>-1&&(this||t).__handlers.splice(n,1)}}},{key:"destroyObserver",value:function(){(this||t).observer&&(this||t).observer.disconnect(),(this||t).observer=null,(this||t).__handlers=null}},{key:"__runHandler",value:function(e){for(var n=(this||t).__handlers,i=0;i<n.length;i++)if(n[i]&&e===n[i].target){n[i].handler&&n[i].handler.map((function(t){try{t()}catch(t){console.error(t)}}));break}}},{key:"__trigger",value:function(e){var n=this||t;e.map((function(t){n.__runHandler(t.target)}))}}]),e}());n.addObserver=function(t,e){a.addObserver(t,e)},n.unObserver=function(t,e){a.unObserver(t,e)},n.destroyObserver=function(t,e){a.destroyObserver(t,e)}},function(t,e,n){var i=n(35);"string"==typeof i&&(i=[[t.i,i,""]]);var o={hmr:!0,transform:void 0,insertInto:void 0};n(37)(i,o);i.locals&&(t.exports=i.locals)},function(t,e,n){(t.exports=n(36)(!1)).push([t.i,".danmu{overflow:hidden;-webkit-user-select:none;-moz-user-select:none;user-select:none;-ms-user-select:none}.danmu>*{position:absolute;white-space:nowrap}.danmu-switch{width:32px;height:20px;border-radius:100px;background-color:#ccc;-webkit-box-sizing:border-box;box-sizing:border-box;outline:none;cursor:pointer;position:relative;text-align:center;margin:10px auto}.danmu-switch.danmu-switch-active{padding-left:12px;background-color:#f85959}.danmu-switch span.txt{width:20px;height:20px;line-height:20px;text-align:center;display:block;border-radius:100px;background-color:#fff;-webkit-box-shadow:-2px 0 0 0 rgba(0, 0, 0, .04);box-shadow:-2px 0 0 0 rgba(0, 0, 0, .04);font-family:PingFangSC;font-size:10px;font-weight:500;color:#f44336}",""])},function(e,n){e.exports=function(e){var n=[];return n.toString=function(){return this.map((function(t){var n=function(t,e){var n=t[1]||"",i=t[3];if(!i)return n;if(e&&"function"==typeof btoa){var o=(a=i,"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(a))))+" */"),r=i.sources.map((function(t){return"/*# sourceURL="+i.sourceRoot+t+" */"}));return[n].concat(r).concat([o]).join("\n")}var a;return[n].join("\n")}(t,e);return t[2]?"@media "+t[2]+"{"+n+"}":n})).join("")},n.i=function(e,i){"string"==typeof e&&(e=[[null,e,""]]);for(var o={},r=0;r<(this||t).length;r++){var a=(this||t)[r][0];"number"==typeof a&&(o[a]=!0)}for(r=0;r<e.length;r++){var s=e[r];"number"==typeof s[0]&&o[s[0]]||(i&&!s[2]?s[2]=i:i&&(s[2]="("+s[2]+") and ("+i+")"),n.push(s))}},n}},function(e,n,i){var o,r,a={},s=(o=function(){return window&&document&&document.all&&!window.atob},function(){return void 0===r&&(r=o.apply(this||t,arguments)),r}),l=function(t){return document.querySelector(t)},u=function(){var e={};return function(n){if("function"==typeof n)return n();if(void 0===e[n]){var i=l.call(this||t,n);if(window.HTMLIFrameElement&&i instanceof window.HTMLIFrameElement)try{i=i.contentDocument.head}catch(n){i=null}e[n]=i}return e[n]}}(),c=null,h=0,f=[],d=i(38);function p(t,e){for(var n=0;n<t.length;n++){var i=t[n],o=a[i.id];if(o){o.refs++;for(var r=0;r<o.parts.length;r++)o.parts[r](i.parts[r]);for(;r<i.parts.length;r++)o.parts.push(_(i.parts[r],e))}else{var s=[];for(r=0;r<i.parts.length;r++)s.push(_(i.parts[r],e));a[i.id]={id:i.id,refs:1,parts:s}}}}function m(t,e){for(var n=[],i={},o=0;o<t.length;o++){var r=t[o],a=e.base?r[0]+e.base:r[0],s={css:r[1],media:r[2],sourceMap:r[3]};i[a]?i[a].parts.push(s):n.push(i[a]={id:a,parts:[s]})}return n}function v(t,e){var n=u(t.insertInto);if(!n)throw new Error("Couldn't find a style target. This probably means that the value for the 'insertInto' parameter is invalid.");var i=f[f.length-1];if("top"===t.insertAt)i?i.nextSibling?n.insertBefore(e,i.nextSibling):n.appendChild(e):n.insertBefore(e,n.firstChild),f.push(e);else if("bottom"===t.insertAt)n.appendChild(e);else{if("object"!=typeof t.insertAt||!t.insertAt.before)throw new Error("[Style Loader]\n\n Invalid value for parameter 'insertAt' ('options.insertAt') found.\n Must be 'top', 'bottom', or Object.\n (https://github.com/webpack-contrib/style-loader#insertat)\n");var o=u(t.insertInto+" "+t.insertAt.before);n.insertBefore(e,o)}}function g(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t);var e=f.indexOf(t);e>=0&&f.splice(e,1)}function y(t){var e=document.createElement("style");return void 0===t.attrs.type&&(t.attrs.type="text/css"),b(e,t.attrs),v(t,e),e}function b(t,e){Object.keys(e).forEach((function(n){t.setAttribute(n,e[n])}))}function _(t,e){var n,i,o,r;if(e.transform&&t.css){if(!(r=e.transform(t.css)))return function(){};t.css=r}if(e.singleton){var a=h++;n=c||(c=y(e)),i=O.bind(null,n,a,!1),o=O.bind(null,n,a,!0)}else t.sourceMap&&"function"==typeof URL&&"function"==typeof URL.createObjectURL&&"function"==typeof URL.revokeObjectURL&&"function"==typeof Blob&&"function"==typeof btoa?(n=function(t){var e=document.createElement("link");return void 0===t.attrs.type&&(t.attrs.type="text/css"),t.attrs.rel="stylesheet",b(e,t.attrs),v(t,e),e}(e),i=C.bind(null,n,e),o=function(){g(n),n.href&&URL.revokeObjectURL(n.href)}):(n=y(e),i=T.bind(null,n),o=function(){g(n)});return i(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap)return;i(t=e)}else o()}}e.exports=function(t,e){if("undefined"!=typeof DEBUG&&DEBUG&&"object"!=typeof document)throw new Error("The style-loader cannot be used in a non-browser environment");(e=e||{}).attrs="object"==typeof e.attrs?e.attrs:{},e.singleton||"boolean"==typeof e.singleton||(e.singleton=s()),e.insertInto||(e.insertInto="head"),e.insertAt||(e.insertAt="bottom");var n=m(t,e);return p(n,e),function(t){for(var i=[],o=0;o<n.length;o++){var r=n[o];(s=a[r.id]).refs--,i.push(s)}t&&p(m(t,e),e);for(o=0;o<i.length;o++){var s;if(0===(s=i[o]).refs){for(var l=0;l<s.parts.length;l++)s.parts[l]();delete a[s.id]}}}};var k,w=(k=[],function(t,e){return k[t]=e,k.filter(Boolean).join("\n")});function O(t,e,n,i){var o=n?"":i.css;if(t.styleSheet)t.styleSheet.cssText=w(e,o);else{var r=document.createTextNode(o),a=t.childNodes;a[e]&&t.removeChild(a[e]),a.length?t.insertBefore(r,a[e]):t.appendChild(r)}}function T(t,e){var n=e.css,i=e.media;if(i&&t.setAttribute("media",i),t.styleSheet)t.styleSheet.cssText=n;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(n))}}function C(t,e,n){var i=n.css,o=n.sourceMap,r=void 0===e.convertToAbsoluteUrls&&o;(e.convertToAbsoluteUrls||r)&&(i=d(i)),o&&(i+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(o))))+" */");var a=new Blob([i],{type:"text/css"}),s=t.href;t.href=URL.createObjectURL(a),s&&URL.revokeObjectURL(s)}},function(t,e){t.exports=function(t){var e="undefined"!=typeof window&&window.location;if(!e)throw new Error("fixUrls requires window.location");if(!t||"string"!=typeof t)return t;var n=e.protocol+"//"+e.host,i=n+e.pathname.replace(/\/[^\/]*$/,"/");return t.replace(/url\s*\(((?:[^)(]|\((?:[^)(]+|\([^)(]*\))*\))*)\)/gi,(function(t,e){var o,r=e.trim().replace(/^"(.*)"$/,(function(t,e){return e})).replace(/^'(.*)'$/,(function(t,e){return e}));return/^(#|data:|http:\/\/|https:\/\/|file:\/\/\/|\s*$)/i.test(r)?t:(o=0===r.indexOf("//")?r:0===r.indexOf("/")?n+r:i+r.replace(/^\.\//,""),"url("+JSON.stringify(o)+")")}))}}])}));var n=e;export{n as default};

