<div class="h-screen mx-auto px-4 py-8"
     data-controller="audio-player"
     data-audio-player-subtitles-value="<%= (@audio.formatted_transcription || []).to_json %>"
     data-audio-player-index-value="-1">

  <div class="mb-6">
    <h1 class="text-2xl font-bold text-gray-800 dark:text-white mb-2"><%= @audio.title %></h1>
  </div>

  <!-- 音频播放器 -->
  <div class="mb-6 rounded-lg p-4">
    <audio id="audio-player" controls class="w-full" data-audio-player-target="player">
      <source src="<%= rails_blob_url(@audio.audio_file) %>" type="audio/mpeg">
    </audio>
  </div>

  <!-- 字幕区域 -->
  <div class="bg-white dark:bg-gray-800 rounded-lg shadow max-h-[550px] overflow-y-auto" data-audio-player-target="subtitleList">
    <div class="border-b border-gray-200 dark:border-gray-700 px-4 py-3">
      <h2 class="text-lg font-semibold text-gray-800 dark:text-white">音频字幕</h2>
    </div>
    <div class="p-4">
      <% if @audio.has_transcription? %>
        <% @audio.formatted_transcription.each_with_index do |segment, index| %>
          <div class="subtitle-item p-2 border-b border-gray-100 cursor-pointer transition-colors duration-150" data-index="<%= index %>" data-start="<%= segment[:start] %>">
            <div class="text-xs text-gray-500 dark:text-gray-400 mb-1">
              <% if segment[:time_str] %>
                <%= segment[:time_str] %>
              <% else %>
                <% minutes = (segment[:start]/60).to_i %>
                <% seconds = (segment[:start]%60).to_i %>
                <%= "#{minutes.to_s.rjust(2, '0')}:#{seconds.to_s.rjust(2, '0')}" %>
              <% end %>
            </div>
            <div class="text-sm text-gray-800 dark:text-gray-200"><%= segment[:text] %></div>
          </div>
        <% end %>
      <% else %>
        <div class="text-center text-gray-500 dark:text-gray-400 p-6 text-sm">此音频暂无字幕</div>
      <% end %>
    </div>
  </div>

  <!-- 状态信息 -->
  <div class="mt-4 border-t border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 p-2 sm:p-3">
    <div class="max-w-7xl mx-auto flex flex-row justify-center gap-3 sm:gap-6 text-xs sm:text-sm text-center">
      <div class="flex items-center gap-2">
        <span class="text-gray-600 dark:text-gray-400 font-medium">当前时间:</span>
        <span
          data-audio-player-target="currentTime"
          class="text-gray-800 dark:text-gray-200 font-mono"
        >
          00:00
        </span>
      </div>

      <div class="flex items-center gap-2">
        <span class="text-gray-600 dark:text-gray-400 font-medium">当前字幕:</span>
        <span
          data-audio-player-target="currentSubtitleIndex"
          class="text-gray-800 dark:text-gray-200 font-mono"
        >
          - / -
        </span>
      </div>
    </div>
  </div>
</div>
